{% extends 'base.html' %}
{% block header-css %}


{% endblock %}

{% block page-content-title %}
Dashboard
{% endblock %}
{% load staticfiles %}
{% block page-nav-tab %}
<!--~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~-->
<ol class="breadcrumb">
    <li><a href="{% url 'index' %}">仪表盘</a></li>
</ol>
{% endblock %}



{% block page-content %}
<div class="row">
    <div class="panel">
        <div class="panel-body" >
            <div id="asset_categories" style="width: 1000px;height:500px;">
                <div class="col-sm-4 placeholder">
                  <ul class="list-group">
                    <li class="list-group-item  active">服务器信息(<!--{{ret.nowtime|date:"Y-m-d H:i:s"}}-->)</li>
                    <li class="list-group-item">系统负载 : <strong><!--{{ret.sysone}}, {{ret.sysfive}}, {{ret.sysfifteen}}--></strong></li>
                    <li class="list-group-item">CPU利用率 : <strong><!--{{ret.cpuperc}}-->%</strong></li>
                    <li class="list-group-item">内存 : <strong><!--{{ret.memused}}G/{{ret.memtotal}}G {{ret.memperc}}-->%</strong></li>
                    <li class="list-group-item">硬盘 : <strong><!--{{ret.diskused}}G/{{ret.disktotal}}G {{ret.diskperc}}-->%</strong></li>
                  </ul>
                </div>
                <div class="col-sm-4 placeholder">
                  <ul class="list-group">
                    <li class="list-group-item active">组件状态(<!--{{ret.proctime|date:"Y-m-d H:i:s"}}-->)</li>
                    <li class="list-group-item">SaltStack进程 : <strong><!--{{ret.saltst}}--></strong></li>
                    <li class="list-group-item">Salt-API进程 : <strong><!--{{ret.apist}}--></strong></li>
                    <li class="list-group-item">MySQL进程 : <strong><!--{{ret.myst}}--></strong></li>
                    <li class="list-group-item">SNMP进程 : <strong><!--{{ret.snmpst}}--></strong></li>
                  </ul>
                </div>
                <div class="col-sm-2 placeholder">
                  <ul class="list-group">
                    <li class="list-group-item active">Minions状态</li>
                    <li class="list-group-item">总量 : <strong><!--{{ret.num_miniall}}--></strong> 台</li>
                    <li class="list-group-item">在线 : <strong><!--{{ret.num_miniup}}--></strong> 台</li>
                    <li class="list-group-item">离线 : <strong><!--{{ret.num_minidown}}--></strong> 台</li>
                    <!--li class="list-group-item">备用</li-->
                  </ul>
                </div>
                <div class="col-sm-2 placeholder">
                  <ul class="list-group">
                    <a class="list-group-item active">Key列表</a>
                    <a class="list-group-item">已接受 : <strong><!--{{ret.num_mini}}--></strong> 台</a>
                    <a class="list-group-item">待接受 : <strong><!--{{ret.num_minipre}}--></strong> 台</a>
                    <a class="list-group-item">已拒绝 : <strong><!--{{ret.num_minirej}}--></strong> 台</a>
                    <!--li class="list-group-item">备用</li-->
                  </ul>
                </div>
                <div class="col-sm-8 placeholder">
                  <div class="panel panel-primary">
                    <div class="panel-heading">
                      <h3 class="panel-title">操作记录</h3>
                    </div>
                    <div class="panel-body">
                      <pre><!--{{ stret }}--></pre>
                    </div>
                  </div>
                </div>
            </div>
        </div>
    </div>

</div>
<!--
<div class="row">
    <div class="panel col-md-7">
        <div class="panel-body" >
            <div id="business_load" style="width: 600px;height:400px;"></div>
        </div>
    </div>
</div>
-->
{% endblock %}

{% block bottom-js %}

<script>
// 第二个参数可以指定前面引入的主题
    $(document).ready(function ()
        {
         $.getJSON("{% url 'asset:get_dashboard_data' %}",function(callback){
             console.log(callback)

             DrawCharts(callback);
         });//end getJSON

        }
    );//end doc ready


    function DrawCharts(chart_data) {

        var chart = echarts.init(document.getElementById('asset_categories'), 'infographic');
        chart.setOption({
            title: {
                text: '资产分类统计',
                subtext: '董晓义'
            },
            tooltip: {},
            legend: {
                data:['资产类型']
            },
            xAxis: {
                data:chart_data.asset_categories['names']
            },
            yAxis: {},
            series: [{
                name: '资产数量',
                type: 'bar',
                data:chart_data.asset_categories['data'],
                label: {
                    normal: {
                        show: true,
                        position: 'inside'
                    }
                },
            }]
        });


        var chart2 = echarts.init(document.getElementById('asset_status'), 'infographic');
        chart2.setOption({
            title : {
                text: '资产状态分类',
                subtext: '董晓义',
                x:'center'
            },
            tooltip : {
                trigger: 'item',
                formatter: "{a} <br/>{b} : {c} ({d}%)"
            },
            legend: {
                orient: 'vertical',
                left: 'left',
                data:chart_data.asset_status_list['names']
            },
            series : [
                {
                    name: '访问来源',
                    type: 'pie',
                    radius: ['50%', '70%'],
                    avoidLabelOverlap: false,

                    //radius : '55%',
                    center: ['50%', '60%'],
                    data: chart_data.asset_status_list['data'],/*[
                        {value:335, name:'直接访问'},
                        {value:310, name:'邮件营销'},
                        {value:234, name:'联盟广告'},
                        {value:135, name:'视频广告'},
                        {value:1548, name:'搜索引擎'}
                    ],*/
                    itemStyle: {
                        emphasis: {
                            shadowBlur: 10,
                            shadowOffsetX: 0,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        },

                    },
                    label: {
                        normal: {
                            show: true,
                            position: 'inside'
                        },
                        emphasis: {
                            show: true,
                            textStyle: {
                                fontSize: '30',
                                fontWeight: 'bold'
                            }
                        }
                    }

                }
            ]
        })


        //business load
        var chart3 = echarts.init(document.getElementById('business_load'), 'infographic');
        chart3.setOption({
            title : {
                text: '各业务线负载率统计',
                subtext: '董晓义',
                x:'center'
            },
            tooltip : {
                trigger: 'axis',
                axisPointer : {            // 坐标轴指示器，坐标轴触发有效
                    type : 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
                }
            },
            legend: {
                data: chart_data.business_load['names']
                //data: ['直接访问', '邮件营销','联盟广告','视频广告','搜索引擎']
            },
            grid: {
                left: '3%',
                right: '4%',
                bottom: '3%',
                containLabel: true
            },
            xAxis:  {
                type: 'value'
            },
            yAxis: {
                type: 'category',
                data: chart_data.business_load['names']
            },
            series: [
                {
                    name: '负载率',
                    type: 'bar',
                    stack: '总量',
                    label: {
                        normal: {
                            show: true,
                            position: 'insideRight'
                        }
                    },
                    data: chart_data.business_load['data']['load']
                },
                {
                    name: '空闲率',
                    type: 'bar',
                    stack: '总量',
                    label: {
                        normal: {
                            show: true,
                            position: 'insideRight'
                        }
                    },
                    itemStyle :{
                        normal: {color: 'yellowgreen'}
                    },
                    data: chart_data.business_load['data']['left']
                },

            ]
        });
    }
</script>
{% endblock %}