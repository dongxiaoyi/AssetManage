{% extends 'base.html' %}
{% load custom_tag %}
{% block header-css %}


{% endblock %}

{% block page-content-title %}
Dashboard
{% endblock %}
{% load staticfiles %}
{% block page-nav-tab %}
<!--~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~-->
<ol class="breadcrumb">
    <li><a href="{% url 'index' %}">仪表盘</a></li>
</ol>
{% endblock %}



{% block page-content %}
<div class="row">
    <div class="panel">
        <div class="panel-body" >
            <div id="asset_categories" style="width: 1000px;height:500px;">
   <div class="row">
        <form class="form-horizontal form-border" method="get" enctype="multipart/form-data" action="">
            <div class="col-sm-10 col-sm-offset-1">
                <div class="panel panel-default">
                    <div class="panel-body">
                        <div class="form-group">
                            <label class="col-sm-1 control-label">主机</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" name="tgt" value=>
                            </div>
                        </div>
                        <div class="form-group">
                              <label class="col-sm-1 control-label">分组
                              </label>
                              <div class="col-sm-10">
                                  <div class="col-sm-2">
                                       <label class="checkbox-inline">
                                           <input class="icheck" type="checkbox" value="*" name="datacenter">全部
                                       </label>
                                  </div><!--
                                    {% for dcen_li in dcen_list %}
                                        {% for dcen,dccn in data_centers.iteritems %}
                                            {% if dcen == dcen_li %}
                                                <div class="col-sm-2">
                                                    <label class="checkbox-inline">
                                                        <input class="icheck" type="checkbox" value="{{ dcen }}" name="datacenter">{{ dccn }}
                                                    </label>
                                                </div>
                                            {% endif %}
                                        {% endfor %}
                                    {% endfor %}
                              </div>
                        </div>
                        <div class="form-group">
                              <label class="col-sm-1 control-label">程序</label>
                              <div class="col-sm-10">
                                  {% for sls in sls_list %}
                                    {% for sls_key,mod in sls_mod_dict.iteritems %}
                                        {% if sls == sls_key %}
                                            <div class="col-sm-2">
                                                <label class="radio-inline">
                                                  <input class="icheck" type="radio"  value="{{ sls }}" name="sls">{{ mod }}
                                                </label>
                                            </div>
                                        {% endif %}
                                    {% endfor %}
                                  {% endfor %}-->
                              </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="form-group">
                 <div class="col-sm-offset-9 col-sm-1">
                     <button type="button" class="btn btn-primary" onclick="saltFunc()" id="salt_submit">提交</button>
                 </div>
            </div>
            <div class="col-sm-10 col-sm-offset-1">
                <div class='bg-success'>
                    <h4 id="info"></h4>
                </div>
                <div>
                    <p id="result"></p>
                </div>
            </div>
        </form>
   </div>

            </div>
        </div>
    </div>

</div>
<!--
<div class="row">
    <div class="panel col-md-7">
        <div class="panel-body" >
            <div id="business_load" style="width: 600px;height:400px;"></div>
        </div>
    </div>
</div>
-->
{% endblock %}

{% block bottom-js %}

<script>
// 第二个参数可以指定前面引入的主题
    $(document).ready(function ()
        {
         $.getJSON("{% url 'asset:get_dashboard_data' %}",function(callback){
             console.log(callback)

             DrawCharts(callback);
         });//end getJSON

        }
    );//end doc ready


    function DrawCharts(chart_data) {

        var chart = echarts.init(document.getElementById('asset_categories'), 'infographic');
        chart.setOption({
            title: {
                text: '资产分类统计',
                subtext: '董晓义'
            },
            tooltip: {},
            legend: {
                data:['资产类型']
            },
            xAxis: {
                data:chart_data.asset_categories['names']
            },
            yAxis: {},
            series: [{
                name: '资产数量',
                type: 'bar',
                data:chart_data.asset_categories['data'],
                label: {
                    normal: {
                        show: true,
                        position: 'inside'
                    }
                },
            }]
        });


        var chart2 = echarts.init(document.getElementById('asset_status'), 'infographic');
        chart2.setOption({
            title : {
                text: '资产状态分类',
                subtext: '董晓义',
                x:'center'
            },
            tooltip : {
                trigger: 'item',
                formatter: "{a} <br/>{b} : {c} ({d}%)"
            },
            legend: {
                orient: 'vertical',
                left: 'left',
                data:chart_data.asset_status_list['names']
            },
            series : [
                {
                    name: '访问来源',
                    type: 'pie',
                    radius: ['50%', '70%'],
                    avoidLabelOverlap: false,

                    //radius : '55%',
                    center: ['50%', '60%'],
                    data: chart_data.asset_status_list['data'],/*[
                        {value:335, name:'直接访问'},
                        {value:310, name:'邮件营销'},
                        {value:234, name:'联盟广告'},
                        {value:135, name:'视频广告'},
                        {value:1548, name:'搜索引擎'}
                    ],*/
                    itemStyle: {
                        emphasis: {
                            shadowBlur: 10,
                            shadowOffsetX: 0,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        },

                    },
                    label: {
                        normal: {
                            show: true,
                            position: 'inside'
                        },
                        emphasis: {
                            show: true,
                            textStyle: {
                                fontSize: '30',
                                fontWeight: 'bold'
                            }
                        }
                    }

                }
            ]
        })


        //business load
        var chart3 = echarts.init(document.getElementById('business_load'), 'infographic');
        chart3.setOption({
            title : {
                text: '各业务线负载率统计',
                subtext: '董晓义',
                x:'center'
            },
            tooltip : {
                trigger: 'axis',
                axisPointer : {            // 坐标轴指示器，坐标轴触发有效
                    type : 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
                }
            },
            legend: {
                data: chart_data.business_load['names']
                //data: ['直接访问', '邮件营销','联盟广告','视频广告','搜索引擎']
            },
            grid: {
                left: '3%',
                right: '4%',
                bottom: '3%',
                containLabel: true
            },
            xAxis:  {
                type: 'value'
            },
            yAxis: {
                type: 'category',
                data: chart_data.business_load['names']
            },
            series: [
                {
                    name: '负载率',
                    type: 'bar',
                    stack: '总量',
                    label: {
                        normal: {
                            show: true,
                            position: 'insideRight'
                        }
                    },
                    data: chart_data.business_load['data']['load']
                },
                {
                    name: '空闲率',
                    type: 'bar',
                    stack: '总量',
                    label: {
                        normal: {
                            show: true,
                            position: 'insideRight'
                        }
                    },
                    itemStyle :{
                        normal: {color: 'yellowgreen'}
                    },
                    data: chart_data.business_load['data']['left']
                },

            ]
        });
    }
</script>
{% endblock %}